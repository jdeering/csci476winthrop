<HTML>
<HEAD>
<TITLE>
Markup.h
</TITLE>
</HEAD>
<BODY>
<PRE>
<font color="green">// Markup.h: interface for the CMarkup class.</font>
<font color="green">//</font>
<font color="green">// Markup Release 10.1</font>
<font color="green">// Copyright (C) 2008 First Objective Software, Inc. All rights reserved</font>
<font color="green">// Go to www.firstobject.com for the latest CMarkup and EDOM documentation</font>
<font color="green">// Use in commercial applications requires written permission</font>
<font color="green">// This software is provided "as is", with no warranty.</font>

<font color="blue">#if</font> <font color="black">!</font>defined<font color="black">(</font>_MARKUP_H_INCLUDED_<font color="black">)</font>
<font color="blue">#define</font> _MARKUP_H_INCLUDED_

<font color="blue">#include</font> <font color="maroon">&#60;stdlib.h&#62;</font>
<font color="blue">#include</font> <font color="maroon">&#60;string.h&#62;</font> <font color="green">// memcpy, memset, strcmp...</font>

<font color="green">// Major build options</font>
<font color="green">// MARKUP_WCHAR wide char (2-byte UTF-16 on Windows, 4-byte UTF-32 on Linux and OS X)</font>
<font color="green">// MARKUP_MBCS ANSI/double-byte strings on Windows</font>
<font color="green">// MARKUP_STL (default except VC++) use STL strings instead of MFC strings</font>
<font color="green">// MARKUP_SAFESTR to use string _s functions in VC++ 2005 (_MSC_VER &#62;= 1400)</font>
<font color="green">// MARKUP_WINCONV (default for VC++) for Windows API character conversion</font>
<font color="green">// MARKUP_ICONV (default for GNU) for character conversion on Linux and OS X and other platforms</font>
<font color="green">// MARKUP_STDCONV to use neither WINCONV or ICONV, falls back to setlocale based conversion for ANSI</font>
<font color="green">//</font>
<font color="blue">#if</font> _MSC_VER <font color="black">&#62;</font> <font color="maroon">1000</font> <font color="green">// VC++</font>
<font color="blue">#pragma</font> once
<font color="blue">#if</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_SAFESTR<font color="black">)</font> <font color="green">// not VC++ safe strings</font>
<font color="blue">#pragma</font> <font color="blue">warning</font><font color="black">(</font>disable<font color="black">:</font><font color="maroon">4996</font><font color="black">)</font> <font color="green">// VC++ 2005 deprecated function warnings</font>
<font color="blue">#endif</font> <font color="green">// not VC++ safe strings</font>
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_STL<font color="black">)</font> <font color="black">&</font><font color="black">&</font> _MSC_VER <font color="black">&#60;</font> <font color="maroon">1400</font> <font color="green">// STL pre VC++ 2005</font>
<font color="blue">#pragma</font> <font color="blue">warning</font><font color="black">(</font>disable<font color="black">:</font><font color="maroon">4786</font><font color="black">)</font> <font color="green">// std::string long names</font>
<font color="blue">#endif</font> <font color="green">// VC++ 2005 STL</font>
<font color="blue">#else</font> <font color="green">// not VC++</font>
<font color="blue">#if</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_STL<font color="black">)</font>
<font color="blue">#define</font> MARKUP_STL
<font color="blue">#endif</font> <font color="green">// not STL</font>
<font color="blue">#if</font> defined<font color="black">(</font>__GNUC__<font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_ICONV<font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_STDCONV<font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_WINCONV<font color="black">)</font>
<font color="blue">#define</font> MARKUP_ICONV
<font color="blue">#endif</font> <font color="green">// GNUC and not ICONV not STDCONV not WINCONV</font>
<font color="blue">#endif</font> <font color="green">// not VC++</font>
<font color="blue">#if</font> <font color="black">(</font>defined<font color="black">(</font>_UNICODE<font color="black">)</font> <font color="black">|</font><font color="black">|</font> defined<font color="black">(</font>UNICODE<font color="black">)</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_WCHAR<font color="black">)</font>
<font color="blue">#define</font> MARKUP_WCHAR
<font color="blue">#endif</font> <font color="green">// _UNICODE or UNICODE</font>
<font color="blue">#if</font> <font color="black">(</font>defined<font color="black">(</font>_MBCS<font color="black">)</font> <font color="black">|</font><font color="black">|</font> defined<font color="black">(</font>MBCS<font color="black">)</font><font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_MBCS<font color="black">)</font>
<font color="blue">#define</font> MARKUP_MBCS
<font color="blue">#endif</font> <font color="green">// _MBCS and not MBCS</font>
<font color="blue">#if</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_SIZEOFWCHAR<font color="black">)</font>
<font color="blue">#if</font> __SIZEOF_WCHAR_T__ <font color="black">=</font><font color="black">=</font> <font color="maroon">4</font> <font color="black">|</font><font color="black">|</font> __WCHAR_MAX__ <font color="black">&#62;</font> <font color="maroon">0x10000</font>
<font color="blue">#define</font> MARKUP_SIZEOFWCHAR <font color="maroon">4</font>
<font color="blue">#else</font> <font color="green">// sizeof(wchar_t) != 4</font>
<font color="blue">#define</font> MARKUP_SIZEOFWCHAR <font color="maroon">2</font>
<font color="blue">#endif</font> <font color="green">// sizeof(wchar_t) != 4</font>
<font color="blue">#endif</font> <font color="green">// not MARKUP_SIZEOFWCHAR</font>
<font color="blue">#if</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_WINCONV<font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_STDCONV<font color="black">)</font> <font color="black">&</font><font color="black">&</font> <font color="black">!</font> defined<font color="black">(</font>MARKUP_ICONV<font color="black">)</font>
<font color="blue">#define</font> MARKUP_WINCONV
<font color="blue">#endif</font> <font color="green">// not WINCONV not STDCONV not ICONV</font>

<font color="green">// Text type and function defines (compiler and build-option dependent)</font>
<font color="green">// </font>
<font color="blue">#define</font> MCD_ACP <font color="maroon">0</font>
<font color="blue">#define</font> MCD_UTF8 <font color="maroon">65001</font>
<font color="blue">#define</font> MCD_UTF16 <font color="maroon">1200</font>
<font color="blue">#define</font> MCD_UTF32 <font color="maroon">65005</font>
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_WCHAR<font color="black">)</font>
<font color="blue">#define</font> MCD_CHAR wchar_t
<font color="blue">#define</font> MCD_PCSZ <font color="blue">const</font> wchar_t<font color="black">*</font>
<font color="blue">#define</font> MCD_PSZLEN <font color="black">(</font><font color="blue">int</font><font color="black">)</font>wcslen
<font color="blue">#define</font> MCD_PSZCHR wcschr
<font color="blue">#define</font> MCD_PSZSTR wcsstr
<font color="blue">#define</font> MCD_PSZTOL wcstol
<font color="blue">#define</font> MCD_PSZNCMP wcsncmp
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_SAFESTR<font color="black">)</font> <font color="green">// VC++ safe strings</font>
<font color="blue">#define</font> MCD_SSZ<font color="black">(</font>sz<font color="black">)</font> sz,<font color="black">(</font><font color="blue">sizeof</font><font color="black">(</font>sz<font color="black">)</font><font color="black">/</font><font color="blue">sizeof</font><font color="black">(</font>MCD_CHAR<font color="black">)</font><font color="black">)</font>
<font color="blue">#define</font> MCD_PSZCPY<font color="black">(</font>sz,p<font color="black">)</font> wcscpy_s<font color="black">(</font>MCD_SSZ<font color="black">(</font>sz<font color="black">)</font>,p<font color="black">)</font>
<font color="blue">#define</font> MCD_PSZNCPY<font color="black">(</font>sz,p,n<font color="black">)</font> wcsncpy_s<font color="black">(</font>MCD_SSZ<font color="black">(</font>sz<font color="black">)</font>,p,n<font color="black">)</font>
<font color="blue">#define</font> MCD_PSZCAT<font color="black">(</font>sz,p<font color="black">)</font> wcscat_s<font color="black">(</font>MCD_SSZ<font color="black">(</font>sz<font color="black">)</font>,p<font color="black">)</font>
<font color="blue">#define</font> MCD_SPRINTF swprintf_s
<font color="blue">#define</font> MCD_FOPEN<font color="black">(</font>f,n,m<font color="black">)</font> <font color="black">{</font><font color="blue">if</font><font color="black">(</font>_wfopen_s<font color="black">(</font><font color="black">&</font>f,n,m<font color="black">)</font><font color="black">!</font><font color="black">=</font><font color="maroon">0</font><font color="black">)</font>f<font color="black">=</font>NULL;<font color="black">}</font>
<font color="blue">#else</font> <font color="green">// not VC++ safe strings</font>
<font color="blue">#if</font> defined<font color="black">(</font>__GNUC__<font color="black">)</font>
<font color="blue">#define</font> MCD_SSZ<font color="black">(</font>sz<font color="black">)</font> sz,<font color="black">(</font><font color="blue">sizeof</font><font color="black">(</font>sz<font color="black">)</font><font color="black">/</font><font color="blue">sizeof</font><font color="black">(</font>MCD_CHAR<font color="black">)</font><font color="black">)</font>
<font color="blue">#else</font> <font color="green">// not GNUC</font>
<font color="blue">#define</font> MCD_SSZ<font color="black">(</font>sz<font color="black">)</font> sz
<font color="blue">#endif</font> <font color="green">// not GNUC</font>
<font color="blue">#define</font> MCD_PSZCPY wcscpy
<font color="blue">#define</font> MCD_PSZNCPY wcsncpy
<font color="blue">#define</font> MCD_PSZCAT wcscat
<font color="blue">#define</font> MCD_SPRINTF swprintf
<font color="blue">#define</font> MCD_FOPEN<font color="black">(</font>f,n,m<font color="black">)</font> f<font color="black">=</font>_wfopen<font color="black">(</font>n,m<font color="black">)</font>
<font color="blue">#endif</font> <font color="green">// not VC++ safe strings</font>
<font color="blue">#define</font> MCD_T<font color="black">(</font>s<font color="black">)</font> L ## s
<font color="blue">#if</font> MARKUP_SIZEOFWCHAR <font color="black">=</font><font color="black">=</font> <font color="maroon">4</font> <font color="green">// sizeof(wchar_t) == 4</font>
<font color="blue">#define</font> MCD_ENC MCD_T<font color="black">(</font><font color="maroon">"UTF-32"</font><font color="black">)</font>
<font color="blue">#else</font> <font color="green">// sizeof(wchar_t) == 2</font>
<font color="blue">#define</font> MCD_ENC MCD_T<font color="black">(</font><font color="maroon">"UTF-16"</font><font color="black">)</font>
<font color="blue">#endif</font>
<font color="blue">#define</font> MCD_CLEN<font color="black">(</font>p<font color="black">)</font> <font color="maroon">1</font>
<font color="blue">#else</font> <font color="green">// not MARKUP_WCHAR</font>
<font color="blue">#define</font> MCD_CHAR <font color="blue">char</font>
<font color="blue">#define</font> MCD_PCSZ <font color="blue">const</font> <font color="blue">char</font><font color="black">*</font>
<font color="blue">#define</font> MCD_PSZLEN <font color="black">(</font><font color="blue">int</font><font color="black">)</font>strlen
<font color="blue">#define</font> MCD_PSZCHR strchr
<font color="blue">#define</font> MCD_PSZSTR strstr
<font color="blue">#define</font> MCD_PSZTOL strtol
<font color="blue">#define</font> MCD_PSZNCMP strncmp
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_SAFESTR<font color="black">)</font> <font color="green">// VC++ safe strings</font>
<font color="blue">#define</font> MCD_SSZ<font color="black">(</font>sz<font color="black">)</font> sz,<font color="black">(</font><font color="blue">sizeof</font><font color="black">(</font>sz<font color="black">)</font><font color="black">/</font><font color="blue">sizeof</font><font color="black">(</font>MCD_CHAR<font color="black">)</font><font color="black">)</font>
<font color="blue">#define</font> MCD_PSZCPY<font color="black">(</font>sz,p<font color="black">)</font> strcpy_s<font color="black">(</font>MCD_SSZ<font color="black">(</font>sz<font color="black">)</font>,p<font color="black">)</font>
<font color="blue">#define</font> MCD_PSZNCPY<font color="black">(</font>sz,p,n<font color="black">)</font> strncpy_s<font color="black">(</font>MCD_SSZ<font color="black">(</font>sz<font color="black">)</font>,p,n<font color="black">)</font>
<font color="blue">#define</font> MCD_PSZCAT<font color="black">(</font>sz,p<font color="black">)</font> strcat_s<font color="black">(</font>MCD_SSZ<font color="black">(</font>sz<font color="black">)</font>,p<font color="black">)</font>
<font color="blue">#define</font> MCD_SPRINTF sprintf_s
<font color="blue">#define</font> MCD_FOPEN<font color="black">(</font>f,n,m<font color="black">)</font> <font color="black">{</font><font color="blue">if</font><font color="black">(</font>fopen_s<font color="black">(</font><font color="black">&</font>f,n,m<font color="black">)</font><font color="black">!</font><font color="black">=</font><font color="maroon">0</font><font color="black">)</font>f<font color="black">=</font>NULL;<font color="black">}</font>
<font color="blue">#else</font> <font color="green">// not VC++ safe strings</font>
<font color="blue">#define</font> MCD_SSZ<font color="black">(</font>sz<font color="black">)</font> sz
<font color="blue">#define</font> MCD_PSZCPY strcpy
<font color="blue">#define</font> MCD_PSZNCPY strncpy
<font color="blue">#define</font> MCD_PSZCAT strcat
<font color="blue">#define</font> MCD_SPRINTF sprintf
<font color="blue">#define</font> MCD_FOPEN<font color="black">(</font>f,n,m<font color="black">)</font> f<font color="black">=</font>fopen<font color="black">(</font>n,m<font color="black">)</font>
<font color="blue">#endif</font> <font color="green">// not VC++ safe strings</font>
<font color="blue">#define</font> MCD_T<font color="black">(</font>s<font color="black">)</font> s
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_MBCS<font color="black">)</font> <font color="green">// MBCS/double byte</font>
<font color="blue">#define</font> MCD_ENC MCD_T<font color="black">(</font><font color="maroon">""</font><font color="black">)</font>
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_WINCONV<font color="black">)</font>
<font color="blue">#define</font> MCD_CLEN<font color="black">(</font>p<font color="black">)</font> <font color="black">(</font><font color="blue">int</font><font color="black">)</font>_mbclen<font color="black">(</font><font color="black">(</font><font color="blue">const</font> <font color="blue">unsigned</font> <font color="blue">char</font><font color="black">*</font><font color="black">)</font>p<font color="black">)</font>
<font color="blue">#else</font> <font color="green">// not WINCONV</font>
<font color="blue">#define</font> MCD_CLEN<font color="black">(</font>p<font color="black">)</font> <font color="black">(</font><font color="blue">int</font><font color="black">)</font>mblen<font color="black">(</font>p,MB_CUR_MAX<font color="black">)</font>
<font color="blue">#endif</font> <font color="green">// not WINCONV</font>
<font color="blue">#else</font> <font color="green">// not MBCS/double byte</font>
<font color="blue">#define</font> MCD_ENC MCD_T<font color="black">(</font><font color="maroon">"UTF-8"</font><font color="black">)</font>
<font color="blue">#define</font> MCD_CLEN<font color="black">(</font>p<font color="black">)</font> <font color="maroon">1</font>
<font color="blue">#endif</font> <font color="green">// not MBCS/double byte</font>
<font color="blue">#endif</font> <font color="green">// not MARKUP_WCHAR</font>
<font color="blue">#if</font> _MSC_VER <font color="black">&#60;</font> <font color="maroon">1000</font> <font color="green">// not VC++</font>
<font color="blue">#define</font> MCD_STRERROR strerror<font color="black">(</font>errno<font color="black">)</font>
<font color="blue">#endif</font> <font color="green">// not VC++</font>

<font color="green">// String type and function defines (compiler and build-option dependent)</font>
<font color="green">// Define MARKUP_STL to use STL strings</font>
<font color="green">//</font>
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_STL<font color="black">)</font> <font color="green">// STL</font>
<font color="blue">#include</font> <font color="maroon">&#60;string&#62;</font>
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_WCHAR<font color="black">)</font>
<font color="blue">#define</font> MCD_STR std<font color="black">:</font><font color="black">:</font>wstring
<font color="blue">#else</font> <font color="green">// not MARKUP_WCHAR</font>
<font color="blue">#define</font> MCD_STR std<font color="black">:</font><font color="black">:</font>string
<font color="blue">#endif</font> <font color="green">// not MARKUP_WCHAR</font>
<font color="blue">#define</font> MCD_2PCSZ<font color="black">(</font>s<font color="black">)</font> s.c_str<font color="black">(</font><font color="black">)</font>
<font color="blue">#define</font> MCD_STRLENGTH<font color="black">(</font>s<font color="black">)</font> <font color="black">(</font><font color="blue">int</font><font color="black">)</font>s.size<font color="black">(</font><font color="black">)</font>
<font color="blue">#define</font> MCD_STRCLEAR<font color="black">(</font>s<font color="black">)</font> s.erase<font color="black">(</font><font color="black">)</font>
<font color="blue">#define</font> MCD_STRISEMPTY<font color="black">(</font>s<font color="black">)</font> s.empty<font color="black">(</font><font color="black">)</font>
<font color="blue">#define</font> MCD_STRMID<font color="black">(</font>s,n,l<font color="black">)</font> s.substr<font color="black">(</font>n,l<font color="black">)</font>
<font color="blue">#define</font> MCD_STRASSIGN<font color="black">(</font>s,p,n<font color="black">)</font> s.assign<font color="black">(</font>p,n<font color="black">)</font>
<font color="blue">#define</font> MCD_STRCAPACITY<font color="black">(</font>s<font color="black">)</font> <font color="black">(</font><font color="blue">int</font><font color="black">)</font>s.capacity<font color="black">(</font><font color="black">)</font>
<font color="blue">#define</font> MCD_STRINSERTREPLACE<font color="black">(</font>d,i,r,s<font color="black">)</font> d.replace<font color="black">(</font>i,r,s<font color="black">)</font>
<font color="blue">#define</font> MCD_GETBUFFER<font color="black">(</font>s,n<font color="black">)</font> <font color="blue">new</font> MCD_CHAR<font color="black">[</font>n<font color="black">+</font><font color="maroon">1</font><font color="black">]</font>; s.reserve<font color="black">(</font>n<font color="black">)</font>
<font color="blue">#define</font> MCD_RELEASEBUFFER<font color="black">(</font>s,p,n<font color="black">)</font> s.assign<font color="black">(</font>p,n<font color="black">)</font>; <font color="blue">delete</font><font color="black">[</font><font color="black">]</font>p
<font color="blue">#define</font> MCD_BLDRESERVE<font color="black">(</font>s,n<font color="black">)</font> s.reserve<font color="black">(</font>n<font color="black">)</font>
<font color="blue">#define</font> MCD_BLDCHECK<font color="black">(</font>s,n,d<font color="black">)</font> ;
<font color="blue">#define</font> MCD_BLDRELEASE<font color="black">(</font>s<font color="black">)</font> ;
<font color="blue">#define</font> MCD_BLDAPPENDN<font color="black">(</font>s,p,n<font color="black">)</font> s.append<font color="black">(</font>p,n<font color="black">)</font>
<font color="blue">#define</font> MCD_BLDAPPEND<font color="black">(</font>s,p<font color="black">)</font> s.append<font color="black">(</font>p<font color="black">)</font>
<font color="blue">#define</font> MCD_BLDAPPEND1<font color="black">(</font>s,c<font color="black">)</font> s<font color="black">+</font><font color="black">=</font><font color="black">(</font>MCD_CHAR<font color="black">)</font><font color="black">(</font>c<font color="black">)</font>
<font color="blue">#else</font> <font color="green">// not STL, i.e. MFC</font>
<font color="blue">#include</font> <font color="maroon">&#60;afx.h&#62;</font>
<font color="blue">#define</font> MCD_STR CString
<font color="blue">#define</font> MCD_2PCSZ<font color="black">(</font>s<font color="black">)</font> <font color="black">(</font><font color="black">(</font>MCD_PCSZ<font color="black">)</font>s<font color="black">)</font>
<font color="blue">#define</font> MCD_STRLENGTH<font color="black">(</font>s<font color="black">)</font> s.GetLength<font color="black">(</font><font color="black">)</font>
<font color="blue">#define</font> MCD_STRCLEAR<font color="black">(</font>s<font color="black">)</font> s.Empty<font color="black">(</font><font color="black">)</font>
<font color="blue">#define</font> MCD_STRISEMPTY<font color="black">(</font>s<font color="black">)</font> s.IsEmpty<font color="black">(</font><font color="black">)</font>
<font color="blue">#define</font> MCD_STRMID<font color="black">(</font>s,n,l<font color="black">)</font> s.Mid<font color="black">(</font>n,l<font color="black">)</font>
<font color="blue">#define</font> MCD_STRASSIGN<font color="black">(</font>s,p,n<font color="black">)</font> memcpy<font color="black">(</font>s.GetBuffer<font color="black">(</font>n<font color="black">)</font>,p,<font color="black">(</font>n<font color="black">)</font><font color="black">*</font><font color="blue">sizeof</font><font color="black">(</font>MCD_CHAR<font color="black">)</font><font color="black">)</font>;s.ReleaseBuffer<font color="black">(</font>n<font color="black">)</font>;
<font color="blue">#define</font> MCD_STRCAPACITY<font color="black">(</font>s<font color="black">)</font> <font color="black">(</font><font color="black">(</font><font color="black">(</font>CStringData<font color="black">*</font><font color="black">)</font><font color="black">(</font><font color="black">(</font>MCD_PCSZ<font color="black">)</font>s<font color="black">)</font><font color="maroon">-1</font><font color="black">)</font><font color="black">-</font><font color="black">&#62;</font>nAllocLength<font color="black">)</font>
<font color="blue">#define</font> MCD_GETBUFFER<font color="black">(</font>s,n<font color="black">)</font> s.GetBuffer<font color="black">(</font>n<font color="black">)</font>
<font color="blue">#define</font> MCD_RELEASEBUFFER<font color="black">(</font>s,p,n<font color="black">)</font> s.ReleaseBuffer<font color="black">(</font>n<font color="black">)</font>
<font color="blue">#define</font> MCD_BLDRESERVE<font color="black">(</font>s,n<font color="black">)</font> MCD_CHAR<font color="black">*</font>pD<font color="black">=</font>s.GetBuffer<font color="black">(</font>n<font color="black">)</font>; <font color="blue">int</font> nL<font color="black">=</font><font color="maroon">0</font>
<font color="blue">#define</font> MCD_BLDCHECK<font color="black">(</font>s,n,d<font color="black">)</font> <font color="blue">if</font><font color="black">(</font>nL<font color="black">+</font><font color="black">(</font><font color="blue">int</font><font color="black">)</font><font color="black">(</font>d<font color="black">)</font><font color="black">&#62;</font>n<font color="black">)</font><font color="black">{</font>s.ReleaseBuffer<font color="black">(</font>nL<font color="black">)</font>;n<font color="black">&#60;</font><font color="black">&#60;</font><font color="black">=</font><font color="maroon">2</font>;pD<font color="black">=</font>s.GetBuffer<font color="black">(</font>n<font color="black">)</font>;<font color="black">}</font>
<font color="blue">#define</font> MCD_BLDRELEASE<font color="black">(</font>s<font color="black">)</font> s.ReleaseBuffer<font color="black">(</font>nL<font color="black">)</font>
<font color="blue">#define</font> MCD_BLDAPPENDN<font color="black">(</font>s,p,n<font color="black">)</font> MCD_PSZNCPY<font color="black">(</font><font color="black">&</font>pD<font color="black">[</font>nL<font color="black">]</font>,p,n<font color="black">)</font>;nL<font color="black">+</font><font color="black">=</font>n
<font color="blue">#define</font> MCD_BLDAPPEND<font color="black">(</font>s,p<font color="black">)</font> MCD_PSZCPY<font color="black">(</font><font color="black">&</font>pD<font color="black">[</font>nL<font color="black">]</font>,p<font color="black">)</font>;nL<font color="black">+</font><font color="black">=</font>MCD_PSZLEN<font color="black">(</font>p<font color="black">)</font>
<font color="blue">#define</font> MCD_BLDAPPEND1<font color="black">(</font>s,c<font color="black">)</font> pD<font color="black">[</font>nL<font color="black">+</font><font color="black">+</font><font color="black">]</font><font color="black">=</font><font color="black">(</font>MCD_CHAR<font color="black">)</font><font color="black">(</font>c<font color="black">)</font>
<font color="blue">#endif</font> <font color="green">// not STL</font>
<font color="blue">#define</font> MCD_STRTOINT<font color="black">(</font>s<font color="black">)</font> MCD_PSZTOL<font color="black">(</font>MCD_2PCSZ<font color="black">(</font>s<font color="black">)</font>,NULL,<font color="maroon">10</font><font color="black">)</font>

<font color="green">// Allow function args to accept string objects as constant string pointers</font>
<font color="blue">struct</font> MCD_CSTR
<font color="black">{</font>
    MCD_CSTR<font color="black">(</font><font color="black">)</font> <font color="black">{</font> pcsz<font color="black">=</font>NULL; <font color="black">}</font>;
    MCD_CSTR<font color="black">(</font> MCD_PCSZ p <font color="black">)</font> <font color="black">{</font> pcsz<font color="black">=</font>p; <font color="black">}</font>;
    MCD_CSTR<font color="black">(</font> <font color="blue">const</font> MCD_STR<font color="black">&</font> s <font color="black">)</font> <font color="black">{</font> pcsz <font color="black">=</font> MCD_2PCSZ<font color="black">(</font>s<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">operator</font> MCD_PCSZ<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> pcsz; <font color="black">}</font>;
    MCD_PCSZ pcsz;
<font color="black">}</font>;

<font color="green">// On Linux and OS X, filenames are not specified in wchar_t</font>
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_WCHAR<font color="black">)</font> <font color="black">&</font><font color="black">&</font> defined<font color="black">(</font>__GNUC__<font color="black">)</font>
<font color="blue">#undef</font> MCD_FOPEN
<font color="blue">#define</font> MCD_FOPEN<font color="black">(</font>f,n,m<font color="black">)</font> f<font color="black">=</font>fopen<font color="black">(</font>n,m<font color="black">)</font>
<font color="blue">#define</font> MCD_T_FILENAME<font color="black">(</font>s<font color="black">)</font> s
<font color="blue">#define</font> MCD_PCSZ_FILENAME <font color="blue">const</font> <font color="blue">char</font><font color="black">*</font>
<font color="blue">struct</font> MCD_CSTR_FILENAME
<font color="black">{</font>
    MCD_CSTR_FILENAME<font color="black">(</font><font color="black">)</font> <font color="black">{</font> pcsz<font color="black">=</font>NULL; <font color="black">}</font>;
    MCD_CSTR_FILENAME<font color="black">(</font> MCD_PCSZ_FILENAME p <font color="black">)</font> <font color="black">{</font> pcsz<font color="black">=</font>p; <font color="black">}</font>;
    MCD_CSTR_FILENAME<font color="black">(</font> <font color="blue">const</font> std<font color="black">:</font><font color="black">:</font>string<font color="black">&</font> s <font color="black">)</font> <font color="black">{</font> pcsz <font color="black">=</font> s.c_str<font color="black">(</font><font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">operator</font> MCD_PCSZ_FILENAME<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> pcsz; <font color="black">}</font>;
    MCD_PCSZ_FILENAME pcsz;
<font color="black">}</font>;
<font color="blue">#else</font>
<font color="blue">#define</font> MCD_CSTR_FILENAME MCD_CSTR
<font color="blue">#define</font> MCD_T_FILENAME MCD_T
<font color="blue">#define</font> MCD_PCSZ_FILENAME MCD_PCSZ
<font color="blue">#endif</font>

<font color="blue">#if</font> defined<font color="black">(</font>_DEBUG<font color="black">)</font> <font color="green">// DEBUG </font>
<font color="blue">#define</font> _DS<font color="black">(</font>i<font color="black">)</font> <font color="black">(</font>i?<font color="black">&</font><font color="black">(</font>MCD_2PCSZ<font color="black">(</font>m_strDoc<font color="black">)</font><font color="black">)</font><font color="black">[</font>m_aPos<font color="black">[</font>i<font color="black">]</font>.nStart<font color="black">]</font><font color="black">:</font><font color="maroon">0</font><font color="black">)</font>
<font color="blue">#define</font> MARKUP_SETDEBUGSTATE m_pMainDS<font color="black">=</font>_DS<font color="black">(</font>m_iPos<font color="black">)</font>; m_pChildDS<font color="black">=</font>_DS<font color="black">(</font>m_iPosChild<font color="black">)</font>
<font color="blue">#else</font> <font color="green">// not DEBUG</font>
<font color="blue">#define</font> MARKUP_SETDEBUGSTATE
<font color="blue">#endif</font> <font color="green">// not DEBUG</font>

<font color="blue">class</font> CMarkup  
<font color="black">{</font>
<font color="blue">public</font><font color="black">:</font>
    CMarkup<font color="black">(</font><font color="black">)</font> <font color="black">{</font> SetDoc<font color="black">(</font> NULL <font color="black">)</font>; InitDocFlags<font color="black">(</font><font color="black">)</font>; <font color="black">}</font>;
    CMarkup<font color="black">(</font> MCD_CSTR szDoc <font color="black">)</font> <font color="black">{</font> SetDoc<font color="black">(</font> szDoc <font color="black">)</font>; InitDocFlags<font color="black">(</font><font color="black">)</font>; <font color="black">}</font>;
    CMarkup<font color="black">(</font> <font color="blue">int</font> nFlags <font color="black">)</font> <font color="black">{</font> SetDoc<font color="black">(</font> NULL <font color="black">)</font>; m_nDocFlags <font color="black">=</font> nFlags; <font color="black">}</font>;
    CMarkup<font color="black">(</font> <font color="blue">const</font> CMarkup<font color="black">&</font> markup <font color="black">)</font> <font color="black">{</font> <font color="black">*</font><font color="blue">this</font> <font color="black">=</font> markup; <font color="black">}</font>;
    <font color="blue">void</font> <font color="blue">operator</font><font color="black">=</font><font color="black">(</font> <font color="blue">const</font> CMarkup<font color="black">&</font> markup <font color="black">)</font>;
    ~CMarkup<font color="black">(</font><font color="black">)</font> <font color="black">{</font><font color="black">}</font>;

    <font color="green">// Navigate</font>
    <font color="blue">bool</font> Load<font color="black">(</font> MCD_CSTR_FILENAME szFileName <font color="black">)</font>;
    <font color="blue">bool</font> SetDoc<font color="black">(</font> MCD_PCSZ pDoc <font color="black">)</font>;
    <font color="blue">bool</font> SetDoc<font color="black">(</font> <font color="blue">const</font> MCD_STR<font color="black">&</font> strDoc <font color="black">)</font>;
    <font color="blue">bool</font> IsWellFormed<font color="black">(</font><font color="black">)</font>;
    <font color="blue">bool</font> FindElem<font color="black">(</font> MCD_CSTR szName<font color="black">=</font>NULL <font color="black">)</font>;
    <font color="blue">bool</font> FindChildElem<font color="black">(</font> MCD_CSTR szName<font color="black">=</font>NULL <font color="black">)</font>;
    <font color="blue">bool</font> IntoElem<font color="black">(</font><font color="black">)</font>;
    <font color="blue">bool</font> OutOfElem<font color="black">(</font><font color="black">)</font>;
    <font color="blue">void</font> ResetChildPos<font color="black">(</font><font color="black">)</font> <font color="black">{</font> x_SetPos<font color="black">(</font>m_iPosParent,m_iPos,<font color="maroon">0</font><font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">void</font> ResetMainPos<font color="black">(</font><font color="black">)</font> <font color="black">{</font> x_SetPos<font color="black">(</font>m_iPosParent,<font color="maroon">0</font>,<font color="maroon">0</font><font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">void</font> ResetPos<font color="black">(</font><font color="black">)</font> <font color="black">{</font> x_SetPos<font color="black">(</font><font color="maroon">0</font>,<font color="maroon">0</font>,<font color="maroon">0</font><font color="black">)</font>; <font color="black">}</font>;
    MCD_STR GetTagName<font color="black">(</font><font color="black">)</font> <font color="blue">const</font>;
    MCD_STR GetChildTagName<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> x_GetTagName<font color="black">(</font>m_iPosChild<font color="black">)</font>; <font color="black">}</font>;
    MCD_STR GetData<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> x_GetData<font color="black">(</font>m_iPos<font color="black">)</font>; <font color="black">}</font>;
    MCD_STR GetChildData<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> x_GetData<font color="black">(</font>m_iPosChild<font color="black">)</font>; <font color="black">}</font>;
    MCD_STR GetElemContent<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> x_GetElemContent<font color="black">(</font>m_iPos<font color="black">)</font>; <font color="black">}</font>;
    MCD_STR GetAttrib<font color="black">(</font> MCD_CSTR szAttrib <font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> x_GetAttrib<font color="black">(</font>m_iPos,szAttrib<font color="black">)</font>; <font color="black">}</font>;
    MCD_STR GetChildAttrib<font color="black">(</font> MCD_CSTR szAttrib <font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> x_GetAttrib<font color="black">(</font>m_iPosChild,szAttrib<font color="black">)</font>; <font color="black">}</font>;
    MCD_STR GetAttribName<font color="black">(</font> <font color="blue">int</font> n <font color="black">)</font> <font color="blue">const</font>;
    <font color="blue">int</font> FindNode<font color="black">(</font> <font color="blue">int</font> nType<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font>;
    <font color="blue">int</font> GetNodeType<font color="black">(</font><font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> m_nNodeType; <font color="black">}</font>;
    <font color="blue">bool</font> SavePos<font color="black">(</font> MCD_CSTR szPosName<font color="black">=</font>MCD_T<font color="black">(</font><font color="maroon">""</font><font color="black">)</font>, <font color="blue">int</font> nMap <font color="black">=</font> <font color="maroon">0</font> <font color="black">)</font>;
    <font color="blue">bool</font> RestorePos<font color="black">(</font> MCD_CSTR szPosName<font color="black">=</font>MCD_T<font color="black">(</font><font color="maroon">""</font><font color="black">)</font>, <font color="blue">int</font> nMap <font color="black">=</font> <font color="maroon">0</font> <font color="black">)</font>;
    <font color="blue">bool</font> SetMapSize<font color="black">(</font> <font color="blue">int</font> nSize, <font color="blue">int</font> nMap <font color="black">=</font> <font color="maroon">0</font> <font color="black">)</font>;
    <font color="blue">const</font> MCD_STR<font color="black">&</font> GetError<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> m_strError; <font color="black">}</font>;
    <font color="blue">int</font> GetDocFlags<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> m_nDocFlags; <font color="black">}</font>;
    <font color="blue">void</font> SetDocFlags<font color="black">(</font> <font color="blue">int</font> nFlags <font color="black">)</font> <font color="black">{</font> m_nDocFlags <font color="black">=</font> nFlags; <font color="black">}</font>;
    <font color="blue">enum</font> MarkupDocFlags
    <font color="black">{</font>
        MDF_UTF16LEFILE <font color="black">=</font> <font color="maroon">1</font>,
        MDF_UTF8PREAMBLE <font color="black">=</font> <font color="maroon">4</font>,
        MDF_IGNORECASE <font color="black">=</font> <font color="maroon">8</font>,
        MDF_READFILE <font color="black">=</font> <font color="maroon">16</font>,
        MDF_WRITEFILE <font color="black">=</font> <font color="maroon">32</font>,
        MDF_APPENDFILE <font color="black">=</font> <font color="maroon">64</font>,
        MDF_UTF16BEFILE <font color="black">=</font> <font color="maroon">128</font>
    <font color="black">}</font>;
    <font color="blue">enum</font> MarkupNodeFlags
    <font color="black">{</font>
        MNF_WITHCDATA      <font color="black">=</font> <font color="maroon">0x01</font>,
        MNF_WITHNOLINES    <font color="black">=</font> <font color="maroon">0x02</font>,
        MNF_WITHXHTMLSPACE <font color="black">=</font> <font color="maroon">0x04</font>,
        MNF_WITHREFS       <font color="black">=</font> <font color="maroon">0x08</font>,
        MNF_WITHNOEND      <font color="black">=</font> <font color="maroon">0x10</font>,
        MNF_ESCAPEQUOTES  <font color="black">=</font> <font color="maroon">0x100</font>,
        MNF_NONENDED   <font color="black">=</font> <font color="maroon">0x100000</font>,
        MNF_ILLDATA    <font color="black">=</font> <font color="maroon">0x200000</font>
    <font color="black">}</font>;
    <font color="blue">enum</font> MarkupNodeType
    <font color="black">{</font>
        MNT_ELEMENT                 <font color="black">=</font> <font color="maroon">1</font>,  <font color="green">// 0x01</font>
        MNT_TEXT                    <font color="black">=</font> <font color="maroon">2</font>,  <font color="green">// 0x02</font>
        MNT_WHITESPACE              <font color="black">=</font> <font color="maroon">4</font>,  <font color="green">// 0x04</font>
        MNT_CDATA_SECTION           <font color="black">=</font> <font color="maroon">8</font>,  <font color="green">// 0x08</font>
        MNT_PROCESSING_INSTRUCTION  <font color="black">=</font> <font color="maroon">16</font>, <font color="green">// 0x10</font>
        MNT_COMMENT                 <font color="black">=</font> <font color="maroon">32</font>, <font color="green">// 0x20</font>
        MNT_DOCUMENT_TYPE           <font color="black">=</font> <font color="maroon">64</font>, <font color="green">// 0x40</font>
        MNT_EXCLUDE_WHITESPACE      <font color="black">=</font> <font color="maroon">123</font>,<font color="green">// 0x7b</font>
        MNT_LONE_END_TAG            <font color="black">=</font> <font color="maroon">128</font>,<font color="green">// 0x80</font>
        MNT_NODE_ERROR              <font color="black">=</font> <font color="maroon">32768</font> <font color="green">// 0x8000</font>
    <font color="black">}</font>;

    <font color="green">// Create</font>
    <font color="blue">bool</font> Save<font color="black">(</font> MCD_CSTR_FILENAME szFileName <font color="black">)</font>;
    <font color="blue">const</font> MCD_STR<font color="black">&</font> GetDoc<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> m_strDoc; <font color="black">}</font>;
    <font color="blue">bool</font> AddElem<font color="black">(</font> MCD_CSTR szName, MCD_CSTR szData<font color="black">=</font>NULL, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddElem<font color="black">(</font>szName,szData,nFlags<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> InsertElem<font color="black">(</font> MCD_CSTR szName, MCD_CSTR szData<font color="black">=</font>NULL, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddElem<font color="black">(</font>szName,szData,nFlags<font color="black">|</font>MNF_INSERT<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> AddChildElem<font color="black">(</font> MCD_CSTR szName, MCD_CSTR szData<font color="black">=</font>NULL, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddElem<font color="black">(</font>szName,szData,nFlags<font color="black">|</font>MNF_CHILD<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> InsertChildElem<font color="black">(</font> MCD_CSTR szName, MCD_CSTR szData<font color="black">=</font>NULL, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddElem<font color="black">(</font>szName,szData,nFlags<font color="black">|</font>MNF_INSERT<font color="black">|</font>MNF_CHILD<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> AddElem<font color="black">(</font> MCD_CSTR szName, <font color="blue">int</font> nValue, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddElem<font color="black">(</font>szName,nValue,nFlags<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> InsertElem<font color="black">(</font> MCD_CSTR szName, <font color="blue">int</font> nValue, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddElem<font color="black">(</font>szName,nValue,nFlags<font color="black">|</font>MNF_INSERT<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> AddChildElem<font color="black">(</font> MCD_CSTR szName, <font color="blue">int</font> nValue, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddElem<font color="black">(</font>szName,nValue,nFlags<font color="black">|</font>MNF_CHILD<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> InsertChildElem<font color="black">(</font> MCD_CSTR szName, <font color="blue">int</font> nValue, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddElem<font color="black">(</font>szName,nValue,nFlags<font color="black">|</font>MNF_INSERT<font color="black">|</font>MNF_CHILD<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> AddAttrib<font color="black">(</font> MCD_CSTR szAttrib, MCD_CSTR szValue <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetAttrib<font color="black">(</font>m_iPos,szAttrib,szValue<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> AddChildAttrib<font color="black">(</font> MCD_CSTR szAttrib, MCD_CSTR szValue <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetAttrib<font color="black">(</font>m_iPosChild,szAttrib,szValue<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> AddAttrib<font color="black">(</font> MCD_CSTR szAttrib, <font color="blue">int</font> nValue <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetAttrib<font color="black">(</font>m_iPos,szAttrib,nValue<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> AddChildAttrib<font color="black">(</font> MCD_CSTR szAttrib, <font color="blue">int</font> nValue <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetAttrib<font color="black">(</font>m_iPosChild,szAttrib,nValue<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> AddSubDoc<font color="black">(</font> MCD_CSTR szSubDoc <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddSubDoc<font color="black">(</font>szSubDoc,<font color="maroon">0</font><font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> InsertSubDoc<font color="black">(</font> MCD_CSTR szSubDoc <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddSubDoc<font color="black">(</font>szSubDoc,MNF_INSERT<font color="black">)</font>; <font color="black">}</font>;
    MCD_STR GetSubDoc<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> x_GetSubDoc<font color="black">(</font>m_iPos<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> AddChildSubDoc<font color="black">(</font> MCD_CSTR szSubDoc <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddSubDoc<font color="black">(</font>szSubDoc,MNF_CHILD<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> InsertChildSubDoc<font color="black">(</font> MCD_CSTR szSubDoc <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddSubDoc<font color="black">(</font>szSubDoc,MNF_CHILD<font color="black">|</font>MNF_INSERT<font color="black">)</font>; <font color="black">}</font>;
    MCD_STR GetChildSubDoc<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> x_GetSubDoc<font color="black">(</font>m_iPosChild<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> AddNode<font color="black">(</font> <font color="blue">int</font> nType, MCD_CSTR szText <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddNode<font color="black">(</font>nType,szText,<font color="maroon">0</font><font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> InsertNode<font color="black">(</font> <font color="blue">int</font> nType, MCD_CSTR szText <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_AddNode<font color="black">(</font>nType,szText,MNF_INSERT<font color="black">)</font>; <font color="black">}</font>;

    <font color="green">// Modify</font>
    <font color="blue">bool</font> RemoveElem<font color="black">(</font><font color="black">)</font>;
    <font color="blue">bool</font> RemoveChildElem<font color="black">(</font><font color="black">)</font>;
    <font color="blue">bool</font> RemoveNode<font color="black">(</font><font color="black">)</font>;
    <font color="blue">bool</font> SetAttrib<font color="black">(</font> MCD_CSTR szAttrib, MCD_CSTR szValue, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetAttrib<font color="black">(</font>m_iPos,szAttrib,szValue,nFlags<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> SetChildAttrib<font color="black">(</font> MCD_CSTR szAttrib, MCD_CSTR szValue, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetAttrib<font color="black">(</font>m_iPosChild,szAttrib,szValue,nFlags<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> SetAttrib<font color="black">(</font> MCD_CSTR szAttrib, <font color="blue">int</font> nValue, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetAttrib<font color="black">(</font>m_iPos,szAttrib,nValue,nFlags<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> SetChildAttrib<font color="black">(</font> MCD_CSTR szAttrib, <font color="blue">int</font> nValue, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetAttrib<font color="black">(</font>m_iPosChild,szAttrib,nValue,nFlags<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> SetData<font color="black">(</font> MCD_CSTR szData, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetData<font color="black">(</font>m_iPos,szData,nFlags<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> SetChildData<font color="black">(</font> MCD_CSTR szData, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetData<font color="black">(</font>m_iPosChild,szData,nFlags<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> SetData<font color="black">(</font> <font color="blue">int</font> nValue <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetData<font color="black">(</font>m_iPos,nValue<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> SetChildData<font color="black">(</font> <font color="blue">int</font> nValue <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetData<font color="black">(</font>m_iPosChild,nValue<font color="black">)</font>; <font color="black">}</font>;
    <font color="blue">bool</font> SetElemContent<font color="black">(</font> MCD_CSTR szContent <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> x_SetElemContent<font color="black">(</font>szContent<font color="black">)</font>; <font color="black">}</font>;

    <font color="green">// Utility</font>
    <font color="blue">static</font> <font color="blue">bool</font> ReadTextFile<font color="black">(</font> MCD_CSTR_FILENAME szFileName, MCD_STR<font color="black">&</font> strDoc, MCD_STR<font color="black">*</font> pstrError<font color="black">=</font>NULL, <font color="blue">int</font><font color="black">*</font> pnDocFlags<font color="black">=</font>NULL, MCD_STR<font color="black">*</font> pstrEncoding<font color="black">=</font>NULL <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> WriteTextFile<font color="black">(</font> MCD_CSTR_FILENAME szFileName, <font color="blue">const</font> MCD_STR<font color="black">&</font> strDoc, MCD_STR<font color="black">*</font> pstrError<font color="black">=</font>NULL, <font color="blue">int</font><font color="black">*</font> pnDocFlags<font color="black">=</font>NULL, MCD_STR<font color="black">*</font> pstrEncoding<font color="black">=</font>NULL <font color="black">)</font>;
    <font color="blue">static</font> MCD_STR EscapeText<font color="black">(</font> MCD_CSTR szText, <font color="blue">int</font> nFlags <font color="black">=</font> <font color="maroon">0</font> <font color="black">)</font>;
    <font color="blue">static</font> MCD_STR UnescapeText<font color="black">(</font> MCD_CSTR szText, <font color="blue">int</font> nTextLength <font color="black">=</font> <font color="maroon">-1</font> <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">int</font> UTF16To8<font color="black">(</font> <font color="blue">char</font> <font color="black">*</font>pszUTF8, <font color="blue">const</font> <font color="blue">unsigned</font> <font color="blue">short</font><font color="black">*</font> pwszUTF16, <font color="blue">int</font> nUTF8Count <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">int</font> UTF8To16<font color="black">(</font> <font color="blue">unsigned</font> <font color="blue">short</font><font color="black">*</font> pwszUTF16, <font color="blue">const</font> <font color="blue">char</font><font color="black">*</font> pszUTF8, <font color="blue">int</font> nUTF8Count <font color="black">)</font>;
    <font color="blue">static</font> MCD_STR UTF8ToA<font color="black">(</font> MCD_CSTR pszUTF8, <font color="blue">int</font><font color="black">*</font> pnFailed <font color="black">=</font> NULL <font color="black">)</font>;
    <font color="blue">static</font> MCD_STR AToUTF8<font color="black">(</font> MCD_CSTR pszANSI <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">void</font> EncodeCharUTF8<font color="black">(</font> <font color="blue">int</font> nUChar, <font color="blue">char</font><font color="black">*</font> pszUTF8, <font color="blue">int</font><font color="black">&</font> nUTF8Len <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">int</font> DecodeCharUTF8<font color="black">(</font> <font color="blue">const</font> <font color="blue">char</font><font color="black">*</font><font color="black">&</font> pszUTF8, <font color="blue">const</font> <font color="blue">char</font><font color="black">*</font> pszUTF8End <font color="black">=</font> NULL <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">void</font> EncodeCharUTF16<font color="black">(</font> <font color="blue">int</font> nUChar, <font color="blue">unsigned</font> <font color="blue">short</font><font color="black">*</font> pwszUTF16, <font color="blue">int</font><font color="black">&</font> nUTF16Len <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">int</font> DecodeCharUTF16<font color="black">(</font> <font color="blue">const</font> <font color="blue">unsigned</font> <font color="blue">short</font><font color="black">*</font><font color="black">&</font> pwszUTF16, <font color="blue">const</font> <font color="blue">unsigned</font> <font color="blue">short</font><font color="black">*</font> pszUTF16End <font color="black">=</font> NULL <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> DetectUTF8<font color="black">(</font> <font color="blue">const</font> <font color="blue">char</font><font color="black">*</font> pText, <font color="blue">int</font> nTextLen, <font color="blue">int</font><font color="black">*</font> pnNonASCII <font color="black">=</font> NULL <font color="black">)</font>;
    <font color="blue">static</font> MCD_STR GetDeclaredEncoding<font color="black">(</font> MCD_CSTR szDoc <font color="black">)</font>;

<font color="blue">protected</font><font color="black">:</font>

<font color="blue">#if</font> defined<font color="black">(</font>_DEBUG<font color="black">)</font>
    MCD_PCSZ m_pMainDS;
    MCD_PCSZ m_pChildDS;
<font color="blue">#endif</font> <font color="green">// DEBUG</font>

    MCD_STR m_strDoc;
    MCD_STR m_strError;

    <font color="blue">int</font> m_iPosParent;
    <font color="blue">int</font> m_iPos;
    <font color="blue">int</font> m_iPosChild;
    <font color="blue">int</font> m_iPosFree;
    <font color="blue">int</font> m_iPosDeleted;
    <font color="blue">int</font> m_nNodeType;
    <font color="blue">int</font> m_nNodeOffset;
    <font color="blue">int</font> m_nNodeLength;
    <font color="blue">int</font> m_nDocFlags;

    <font color="blue">struct</font> ElemPos
    <font color="black">{</font>
        ElemPos<font color="black">(</font><font color="black">)</font> <font color="black">{</font><font color="black">}</font>;
        ElemPos<font color="black">(</font> <font color="blue">const</font> ElemPos<font color="black">&</font> pos <font color="black">)</font> <font color="black">{</font> <font color="black">*</font><font color="blue">this</font> <font color="black">=</font> pos; <font color="black">}</font>;
        <font color="blue">int</font> StartTagLen<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> nStartTagLen; <font color="black">}</font>;
        <font color="blue">void</font> SetStartTagLen<font color="black">(</font> <font color="blue">int</font> n <font color="black">)</font> <font color="black">{</font> nStartTagLen <font color="black">=</font> n; <font color="black">}</font>;
        <font color="blue">void</font> AdjustStartTagLen<font color="black">(</font> <font color="blue">int</font> n <font color="black">)</font> <font color="black">{</font> nStartTagLen <font color="black">+</font><font color="black">=</font> n; <font color="black">}</font>;
        <font color="blue">int</font> EndTagLen<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> nEndTagLen; <font color="black">}</font>;
        <font color="blue">void</font> SetEndTagLen<font color="black">(</font> <font color="blue">int</font> n <font color="black">)</font> <font color="black">{</font> nEndTagLen <font color="black">=</font> n; <font color="black">}</font>;
        <font color="blue">bool</font> IsEmptyElement<font color="black">(</font><font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> <font color="black">(</font>StartTagLen<font color="black">(</font><font color="black">)</font><font color="black">=</font><font color="black">=</font>nLength<font color="black">)</font>?<font color="blue">true</font><font color="black">:</font><font color="blue">false</font>; <font color="black">}</font>;
        <font color="blue">int</font> StartContent<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> nStart <font color="black">+</font> StartTagLen<font color="black">(</font><font color="black">)</font>; <font color="black">}</font>;
        <font color="blue">int</font> ContentLen<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> nLength <font color="black">-</font>StartTagLen<font color="black">(</font><font color="black">)</font> <font color="black">-</font>EndTagLen<font color="black">(</font><font color="black">)</font>; <font color="black">}</font>;
        <font color="blue">int</font> StartAfter<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> nStart <font color="black">+</font> nLength; <font color="black">}</font>;
        <font color="blue">int</font> Level<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> nFlags <font color="black">&</font> <font color="maroon">0xffff</font>; <font color="black">}</font>;
        <font color="blue">void</font> SetLevel<font color="black">(</font> <font color="blue">int</font> nLev <font color="black">)</font> <font color="black">{</font> nFlags <font color="black">=</font> <font color="black">(</font>nFlags <font color="black">&</font> ~<font color="maroon">0xffff</font><font color="black">)</font> <font color="black">|</font> nLev; <font color="black">}</font>;
        <font color="blue">void</font> ClearVirtualParent<font color="black">(</font><font color="black">)</font> <font color="black">{</font> memset<font color="black">(</font><font color="blue">this</font>,<font color="maroon">0</font>,<font color="blue">sizeof</font><font color="black">(</font>ElemPos<font color="black">)</font><font color="black">)</font>; <font color="black">}</font>;

        <font color="green">// Memory size: 8 32-bit integers == 32 bytes</font>
        <font color="blue">int</font> nStart;
        <font color="blue">int</font> nLength;
        <font color="blue">unsigned</font> <font color="blue">int</font> nStartTagLen <font color="black">:</font> <font color="maroon">22</font>; <font color="green">// 4MB limit for start tag</font>
        <font color="blue">unsigned</font> <font color="blue">int</font> nEndTagLen <font color="black">:</font> <font color="maroon">10</font>; <font color="green">// 1K limit for end tag</font>
        <font color="blue">int</font> nFlags; <font color="green">// 16 bits flags, 16 bits level 65536 depth limit</font>
        <font color="blue">int</font> iElemParent;
        <font color="blue">int</font> iElemChild; <font color="green">// first child</font>
        <font color="blue">int</font> iElemNext; <font color="green">// next sibling</font>
        <font color="blue">int</font> iElemPrev; <font color="green">// if this is first, iElemPrev points to last</font>
    <font color="black">}</font>;

    <font color="blue">enum</font> MarkupNodeFlagsInternal
    <font color="black">{</font>
        MNF_REPLACE    <font color="black">=</font> <font color="maroon">0x001000</font>,
        MNF_INSERT     <font color="black">=</font> <font color="maroon">0x002000</font>,
        MNF_CHILD      <font color="black">=</font> <font color="maroon">0x004000</font>,
        MNF_QUOTED     <font color="black">=</font> <font color="maroon">0x008000</font>,
        MNF_EMPTY      <font color="black">=</font> <font color="maroon">0x010000</font>,
        MNF_DELETED    <font color="black">=</font> <font color="maroon">0x020000</font>,
        MNF_FIRST      <font color="black">=</font> <font color="maroon">0x080000</font>,
        MNF_PUBLIC     <font color="black">=</font> <font color="maroon">0x300000</font>,
        MNF_ILLFORMED  <font color="black">=</font> <font color="maroon">0x800000</font>,
        MNF_USER      <font color="black">=</font> <font color="maroon">0xf000000</font>
    <font color="black">}</font>;

    <font color="blue">struct</font> NodePos
    <font color="black">{</font>
        NodePos<font color="black">(</font><font color="black">)</font> <font color="black">{</font><font color="black">}</font>;
        NodePos<font color="black">(</font> <font color="blue">int</font> n <font color="black">)</font> <font color="black">{</font> nNodeFlags<font color="black">=</font>n; nNodeType<font color="black">=</font><font color="maroon">0</font>; nStart<font color="black">=</font><font color="maroon">0</font>; nLength<font color="black">=</font><font color="maroon">0</font>; <font color="black">}</font>;
        <font color="blue">int</font> nNodeType;
        <font color="blue">int</font> nStart;
        <font color="blue">int</font> nLength;
        <font color="blue">int</font> nNodeFlags;
        MCD_STR strMeta;
    <font color="black">}</font>;

    <font color="blue">struct</font> TokenPos
    <font color="black">{</font>
        TokenPos<font color="black">(</font> MCD_CSTR sz, <font color="blue">int</font> n <font color="black">)</font> <font color="black">{</font> Clear<font color="black">(</font><font color="black">)</font>; pDoc<font color="black">=</font>sz; nTokenFlags<font color="black">=</font>n; <font color="black">}</font>;
        <font color="blue">void</font> Clear<font color="black">(</font><font color="black">)</font> <font color="black">{</font> nL<font color="black">=</font><font color="maroon">0</font>; nR<font color="black">=</font><font color="maroon">-1</font>; nNext<font color="black">=</font><font color="maroon">0</font>; <font color="black">}</font>;
        <font color="blue">int</font> Length<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> nR <font color="black">-</font>nL <font color="black">+</font> <font color="maroon">1</font>; <font color="black">}</font>;
        <font color="blue">int</font> StrNIACmp<font color="black">(</font> MCD_PCSZ p1, MCD_PCSZ p2, <font color="blue">int</font> n <font color="black">)</font>
        <font color="black">{</font>
            <font color="green">// string compare ignore case</font>
            <font color="blue">bool</font> bNonA <font color="black">=</font> <font color="blue">false</font>;
            MCD_CHAR c1, c2;
            <font color="blue">while</font> <font color="black">(</font> n<font color="black">-</font><font color="black">-</font><font color="black">)</font>
            <font color="black">{</font>
                c1 <font color="black">=</font> <font color="black">*</font>p1<font color="black">+</font><font color="black">+</font>; c2 <font color="black">=</font> <font color="black">*</font>p2<font color="black">+</font><font color="black">+</font>;
                <font color="blue">if</font> <font color="black">(</font> c1 <font color="black">!</font><font color="black">=</font> c2 <font color="black">)</font>
                <font color="black">{</font>
                    <font color="blue">if</font> <font color="black">(</font>bNonA <font color="black">|</font><font color="black">|</font> <font color="black">!</font><font color="black">(</font><font color="black">(</font>c1<font color="black">&#62;</font><font color="black">=</font><font color="maroon">'a'</font><font color="black">&</font><font color="black">&</font>c1<font color="black">&#60;</font><font color="black">=</font><font color="maroon">'z'</font><font color="black">&</font><font color="black">&</font>c1<font color="black">=</font><font color="black">=</font>c2<font color="black">+</font><font color="black">(</font><font color="maroon">'a'</font><font color="black">-</font><font color="maroon">'A'</font><font color="black">)</font><font color="black">)</font><font color="black">|</font><font color="black">|</font><font color="black">(</font>c2<font color="black">&#62;</font><font color="black">=</font><font color="maroon">'a'</font><font color="black">&</font><font color="black">&</font>c2<font color="black">&#60;</font><font color="black">=</font><font color="maroon">'z'</font><font color="black">&</font><font color="black">&</font>c2<font color="black">=</font><font color="black">=</font>c1<font color="black">+</font><font color="black">(</font><font color="maroon">'a'</font><font color="black">-</font><font color="maroon">'A'</font><font color="black">)</font><font color="black">)</font><font color="black">)</font><font color="black">)</font>
                        <font color="blue">return</font> c1 <font color="black">-</font>c2;
                <font color="black">}</font>
                <font color="blue">else</font> <font color="blue">if</font> <font color="black">(</font> <font color="black">(</font><font color="blue">unsigned</font> <font color="blue">int</font><font color="black">)</font>c1 <font color="black">&#62;</font> <font color="maroon">127</font> <font color="black">)</font>
                    bNonA <font color="black">=</font> <font color="blue">true</font>;
            <font color="black">}</font>
            <font color="blue">return</font> <font color="maroon">0</font>;
        <font color="black">}</font>

        <font color="blue">bool</font> Match<font color="black">(</font> MCD_CSTR szName <font color="black">)</font>
        <font color="black">{</font>
            <font color="blue">int</font> nLen <font color="black">=</font> nR <font color="black">-</font>nL <font color="black">+</font> <font color="maroon">1</font>;
            <font color="blue">if</font> <font color="black">(</font> nTokenFlags <font color="black">&</font> MDF_IGNORECASE <font color="black">)</font>
                <font color="blue">return</font> <font color="black">(</font> <font color="black">(</font>StrNIACmp<font color="black">(</font> <font color="black">&</font>pDoc<font color="black">[</font>nL<font color="black">]</font>, szName, nLen <font color="black">)</font> <font color="black">=</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
                    <font color="black">&</font><font color="black">&</font> <font color="black">(</font> szName<font color="black">[</font>nLen<font color="black">]</font> <font color="black">=</font><font color="black">=</font> <font color="maroon">'\0'</font> <font color="black">|</font><font color="black">|</font> MCD_PSZCHR<font color="black">(</font>MCD_T<font color="black">(</font><font color="maroon">" =/[]"</font><font color="black">)</font>,szName<font color="black">[</font>nLen<font color="black">]</font><font color="black">)</font> <font color="black">)</font> <font color="black">)</font>;
            <font color="blue">else</font>
                <font color="blue">return</font> <font color="black">(</font> <font color="black">(</font>MCD_PSZNCMP<font color="black">(</font> <font color="black">&</font>pDoc<font color="black">[</font>nL<font color="black">]</font>, szName, nLen <font color="black">)</font> <font color="black">=</font><font color="black">=</font> <font color="maroon">0</font><font color="black">)</font>
                    <font color="black">&</font><font color="black">&</font> <font color="black">(</font> szName<font color="black">[</font>nLen<font color="black">]</font> <font color="black">=</font><font color="black">=</font> <font color="maroon">'\0'</font> <font color="black">|</font><font color="black">|</font> MCD_PSZCHR<font color="black">(</font>MCD_T<font color="black">(</font><font color="maroon">" =/[]"</font><font color="black">)</font>,szName<font color="black">[</font>nLen<font color="black">]</font><font color="black">)</font> <font color="black">)</font> <font color="black">)</font>;
        <font color="black">}</font>;
        <font color="blue">int</font> nL;
        <font color="blue">int</font> nR;
        <font color="blue">int</font> nNext;
        MCD_PCSZ pDoc;
        <font color="blue">int</font> nTokenFlags;
        <font color="blue">int</font> nPreSpaceStart;
        <font color="blue">int</font> nPreSpaceLength;
    <font color="black">}</font>;

    <font color="blue">struct</font> SavedPos
    <font color="black">{</font>
        <font color="green">// SavedPos is an entry in the SavedPosMap hash table</font>
        SavedPos<font color="black">(</font><font color="black">)</font> <font color="black">{</font> nSavedPosFlags<font color="black">=</font><font color="maroon">0</font>; iPos<font color="black">=</font><font color="maroon">0</font>; <font color="black">}</font>;
        MCD_STR strName;
        <font color="blue">int</font> iPos;
        <font color="blue">enum</font> <font color="black">{</font> SPM_MAIN <font color="black">=</font> <font color="maroon">1</font>, SPM_CHILD <font color="black">=</font> <font color="maroon">2</font>, SPM_USED <font color="black">=</font> <font color="maroon">4</font>, SPM_LAST <font color="black">=</font> <font color="maroon">8</font> <font color="black">}</font>;
        <font color="blue">int</font> nSavedPosFlags;
    <font color="black">}</font>;

    <font color="blue">struct</font> SavedPosMap
    <font color="black">{</font>
        <font color="green">// SavedPosMap is only created if SavePos/RestorePos are used</font>
        SavedPosMap<font color="black">(</font> <font color="blue">int</font> nSize <font color="black">)</font> <font color="black">{</font> nMapSize<font color="black">=</font>nSize; pTable <font color="black">=</font> <font color="blue">new</font> SavedPos<font color="black">*</font><font color="black">[</font>nSize<font color="black">]</font>; memset<font color="black">(</font>pTable,<font color="maroon">0</font>,nSize<font color="black">*</font><font color="blue">sizeof</font><font color="black">(</font>SavedPos<font color="black">*</font><font color="black">)</font><font color="black">)</font>; <font color="black">}</font>;
        ~SavedPosMap<font color="black">(</font><font color="black">)</font> <font color="black">{</font> <font color="blue">if</font> <font color="black">(</font>pTable<font color="black">)</font> <font color="black">{</font> <font color="blue">for</font> <font color="black">(</font><font color="blue">int</font> n<font color="black">=</font><font color="maroon">0</font>;n<font color="black">&#60;</font>nMapSize;<font color="black">+</font><font color="black">+</font>n<font color="black">)</font> <font color="blue">if</font> <font color="black">(</font>pTable<font color="black">[</font>n<font color="black">]</font><font color="black">)</font> <font color="blue">delete</font><font color="black">[</font><font color="black">]</font> pTable<font color="black">[</font>n<font color="black">]</font>; <font color="blue">delete</font><font color="black">[</font><font color="black">]</font> pTable; <font color="black">}</font> <font color="black">}</font>;
        SavedPos<font color="black">*</font><font color="black">*</font> pTable;
        <font color="blue">int</font> nMapSize;
    <font color="black">}</font>;

    <font color="blue">struct</font> SavedPosMapArray
    <font color="black">{</font>
        <font color="green">// SavedPosMapArray keeps pointers to SavedPosMap instances</font>
        SavedPosMapArray<font color="black">(</font><font color="black">)</font> <font color="black">{</font> pMaps <font color="black">=</font> NULL; <font color="black">}</font>;
        ~SavedPosMapArray<font color="black">(</font><font color="black">)</font> <font color="black">{</font> RemoveAll<font color="black">(</font><font color="black">)</font>; <font color="black">}</font>;
        <font color="blue">void</font> RemoveAll<font color="black">(</font><font color="black">)</font> <font color="black">{</font> SavedPosMap<font color="black">*</font><font color="black">*</font>p <font color="black">=</font> pMaps; <font color="blue">if</font> <font color="black">(</font>p<font color="black">)</font> <font color="black">{</font> <font color="blue">while</font> <font color="black">(</font><font color="black">*</font>p<font color="black">)</font> <font color="blue">delete</font> <font color="black">*</font>p<font color="black">+</font><font color="black">+</font>; <font color="blue">delete</font><font color="black">[</font><font color="black">]</font> pMaps; pMaps<font color="black">=</font>NULL; <font color="black">}</font> <font color="black">}</font>;
        SavedPosMap<font color="black">*</font><font color="black">*</font> pMaps; <font color="green">// NULL terminated array</font>
    <font color="black">}</font>;
    SavedPosMapArray m_SavedPosMapArray;

    <font color="blue">struct</font> PosArray
    <font color="black">{</font>
        PosArray<font color="black">(</font><font color="black">)</font> <font color="black">{</font> Clear<font color="black">(</font><font color="black">)</font>; <font color="black">}</font>;
        ~PosArray<font color="black">(</font><font color="black">)</font> <font color="black">{</font> Release<font color="black">(</font><font color="black">)</font>; <font color="black">}</font>;
        <font color="blue">enum</font> <font color="black">{</font> PA_SEGBITS <font color="black">=</font> <font color="maroon">16</font>, PA_SEGMASK <font color="black">=</font> <font color="maroon">0xffff</font> <font color="black">}</font>;
        <font color="blue">void</font> RemoveAll<font color="black">(</font><font color="black">)</font> <font color="black">{</font> Release<font color="black">(</font><font color="black">)</font>; Clear<font color="black">(</font><font color="black">)</font>; <font color="black">}</font>;
        <font color="blue">void</font> Release<font color="black">(</font><font color="black">)</font> <font color="black">{</font> <font color="blue">for</font> <font color="black">(</font><font color="blue">int</font> n<font color="black">=</font><font color="maroon">0</font>;n<font color="black">&#60;</font>SegsUsed<font color="black">(</font><font color="black">)</font>;<font color="black">+</font><font color="black">+</font>n<font color="black">)</font> <font color="blue">delete</font><font color="black">[</font><font color="black">]</font> <font color="black">(</font><font color="blue">char</font><font color="black">*</font><font color="black">)</font>pSegs<font color="black">[</font>n<font color="black">]</font>; <font color="blue">if</font> <font color="black">(</font>pSegs<font color="black">)</font> <font color="blue">delete</font><font color="black">[</font><font color="black">]</font> <font color="black">(</font><font color="blue">char</font><font color="black">*</font><font color="black">)</font>pSegs; <font color="black">}</font>;
        <font color="blue">void</font> Clear<font color="black">(</font><font color="black">)</font> <font color="black">{</font> nSegs<font color="black">=</font><font color="maroon">0</font>; nSize<font color="black">=</font><font color="maroon">0</font>; pSegs<font color="black">=</font>NULL; <font color="black">}</font>;
        <font color="blue">int</font> GetSize<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> nSize; <font color="black">}</font>;
        <font color="blue">int</font> SegsUsed<font color="black">(</font><font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> <font color="black">(</font><font color="black">(</font>nSize<font color="maroon">-1</font><font color="black">)</font><font color="black">&#62;</font><font color="black">&#62;</font>PA_SEGBITS<font color="black">)</font> <font color="black">+</font> <font color="maroon">1</font>; <font color="black">}</font>;
        ElemPos<font color="black">&</font> <font color="blue">operator</font><font color="black">[</font><font color="black">]</font><font color="black">(</font><font color="blue">int</font> n<font color="black">)</font> <font color="blue">const</font> <font color="black">{</font> <font color="blue">return</font> pSegs<font color="black">[</font>n<font color="black">&#62;</font><font color="black">&#62;</font>PA_SEGBITS<font color="black">]</font><font color="black">[</font>n<font color="black">&</font>PA_SEGMASK<font color="black">]</font>; <font color="black">}</font>;
        ElemPos<font color="black">*</font><font color="black">*</font> pSegs;
        <font color="blue">int</font> nSize;
        <font color="blue">int</font> nSegs;
    <font color="black">}</font>;
    PosArray m_aPos;

    <font color="blue">struct</font> NodeStack
    <font color="black">{</font>
        NodeStack<font color="black">(</font><font color="black">)</font> <font color="black">{</font> nTop<font color="black">=</font><font color="maroon">-1</font>; nSize<font color="black">=</font><font color="maroon">0</font>; pN<font color="black">=</font>NULL; <font color="black">}</font>;
        ~NodeStack<font color="black">(</font><font color="black">)</font> <font color="black">{</font> <font color="blue">if</font> <font color="black">(</font>pN<font color="black">)</font> <font color="blue">delete</font> <font color="black">[</font><font color="black">]</font> pN; <font color="black">}</font>;
        NodePos<font color="black">&</font> Top<font color="black">(</font><font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> pN<font color="black">[</font>nTop<font color="black">]</font>; <font color="black">}</font>;
        NodePos<font color="black">&</font> At<font color="black">(</font> <font color="blue">int</font> n <font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> pN<font color="black">[</font>n<font color="black">]</font>; <font color="black">}</font>;
        <font color="blue">void</font> Add<font color="black">(</font><font color="black">)</font> <font color="black">{</font> <font color="black">+</font><font color="black">+</font>nTop; <font color="blue">if</font> <font color="black">(</font>nTop<font color="black">=</font><font color="black">=</font>nSize<font color="black">)</font> Alloc<font color="black">(</font>nSize<font color="black">*</font><font color="maroon">2</font><font color="black">+</font><font color="maroon">6</font><font color="black">)</font>; <font color="black">}</font>;
        <font color="blue">void</font> Remove<font color="black">(</font><font color="black">)</font> <font color="black">{</font> <font color="black">-</font><font color="black">-</font>nTop; <font color="black">}</font>;
        <font color="blue">int</font> TopIndex<font color="black">(</font><font color="black">)</font> <font color="black">{</font> <font color="blue">return</font> nTop; <font color="black">}</font>;
    <font color="blue">protected</font><font color="black">:</font>
        <font color="blue">void</font> Alloc<font color="black">(</font> <font color="blue">int</font> nNewSize <font color="black">)</font> <font color="black">{</font> NodePos<font color="black">*</font> pNNew <font color="black">=</font> <font color="blue">new</font> NodePos<font color="black">[</font>nNewSize<font color="black">]</font>; Copy<font color="black">(</font>pNNew<font color="black">)</font>; nSize<font color="black">=</font>nNewSize; <font color="black">}</font>;
        <font color="blue">void</font> Copy<font color="black">(</font> NodePos<font color="black">*</font> pNNew <font color="black">)</font> <font color="black">{</font> <font color="blue">for</font><font color="black">(</font><font color="blue">int</font> n<font color="black">=</font><font color="maroon">0</font>;n<font color="black">&#60;</font>nSize;<font color="black">+</font><font color="black">+</font>n<font color="black">)</font> pNNew<font color="black">[</font>n<font color="black">]</font><font color="black">=</font>pN<font color="black">[</font>n<font color="black">]</font>; <font color="blue">if</font> <font color="black">(</font>pN<font color="black">)</font> <font color="blue">delete</font> <font color="black">[</font><font color="black">]</font> pN; pN<font color="black">=</font>pNNew; <font color="black">}</font>;
        NodePos<font color="black">*</font> pN;
        <font color="blue">int</font> nSize;
        <font color="blue">int</font> nTop;
    <font color="black">}</font>;

    <font color="blue">struct</font> FilePos
    <font color="black">{</font>
        FilePos<font color="black">(</font><font color="black">)</font> <font color="black">{</font> fp <font color="black">=</font> NULL; nDocFlags <font color="black">=</font> <font color="maroon">0</font>; nFileByteLen <font color="black">=</font> <font color="maroon">0</font>; <font color="black">}</font>;
        FILE<font color="black">*</font> fp;
        <font color="blue">int</font> nDocFlags;
        <font color="blue">int</font> nFileByteLen;
        <font color="blue">int</font> nReadByteLen;
        <font color="blue">int</font> nFileCharUnitSize;
        <font color="blue">int</font> nFileTextLen;
        MCD_STR strIOResult;
        MCD_STR strEncoding;
    <font color="black">}</font>;

    <font color="blue">struct</font> ConvertEncoding
    <font color="black">{</font>
        ConvertEncoding<font color="black">(</font> MCD_CSTR pszToEncoding, MCD_CSTR pszFromEncoding, <font color="blue">const</font> <font color="blue">void</font><font color="black">*</font> pFromBuffer, <font color="blue">int</font> nFromBufferLen <font color="black">)</font>
        <font color="black">{</font>
            strToEncoding <font color="black">=</font> pszToEncoding;
            strFromEncoding <font color="black">=</font> pszFromEncoding;
            pFrom <font color="black">=</font> pFromBuffer;
            nFromLen <font color="black">=</font> nFromBufferLen;
            nFailedChars <font color="black">=</font> <font color="maroon">0</font>;
            nToCount <font color="black">=</font> <font color="maroon">0</font>;
        <font color="black">}</font>;
        MCD_STR strToEncoding;
        MCD_STR strFromEncoding;
        <font color="blue">const</font> <font color="blue">void</font><font color="black">*</font> pFrom;
        <font color="blue">int</font> nFromLen;
        <font color="blue">int</font> nToCount;
        <font color="blue">int</font> nFailedChars;
    <font color="black">}</font>;

    <font color="blue">void</font> x_SetPos<font color="black">(</font> <font color="blue">int</font> iPosParent, <font color="blue">int</font> iPos, <font color="blue">int</font> iPosChild <font color="black">)</font>
    <font color="black">{</font>
        m_iPosParent <font color="black">=</font> iPosParent;
        m_iPos <font color="black">=</font> iPos;
        m_iPosChild <font color="black">=</font> iPosChild;
        m_nNodeOffset <font color="black">=</font> <font color="maroon">0</font>;
        m_nNodeLength <font color="black">=</font> <font color="maroon">0</font>;
        m_nNodeType <font color="black">=</font> iPos?MNT_ELEMENT<font color="black">:</font><font color="maroon">0</font>;
        MARKUP_SETDEBUGSTATE;
    <font color="black">}</font>;
    <font color="blue">int</font> x_GetFreePos<font color="black">(</font><font color="black">)</font>
    <font color="black">{</font>
        <font color="blue">if</font> <font color="black">(</font> m_iPosFree <font color="black">=</font><font color="black">=</font> m_aPos.GetSize<font color="black">(</font><font color="black">)</font> <font color="black">)</font>
            x_AllocPosArray<font color="black">(</font><font color="black">)</font>;
        <font color="blue">return</font> m_iPosFree<font color="black">+</font><font color="black">+</font>;
    <font color="black">}</font>;
    <font color="blue">bool</font> x_AllocPosArray<font color="black">(</font> <font color="blue">int</font> nNewSize <font color="black">=</font> <font color="maroon">0</font> <font color="black">)</font>;

    <font color="blue">void</font> InitDocFlags<font color="black">(</font><font color="black">)</font>
    <font color="black">{</font>
        <font color="green">// To always ignore case, define MARKUP_IGNORECASE</font>
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_IGNORECASE<font color="black">)</font> <font color="green">// ignore case</font>
        m_nDocFlags <font color="black">=</font> MDF_IGNORECASE;
<font color="blue">#else</font> <font color="green">// not ignore case</font>
        m_nDocFlags <font color="black">=</font> <font color="maroon">0</font>;
<font color="blue">#endif</font> <font color="green">// not ignore case</font>
    <font color="black">}</font>;

    <font color="blue">bool</font> x_ParseDoc<font color="black">(</font><font color="black">)</font>;
    <font color="blue">int</font> x_ParseElem<font color="black">(</font> <font color="blue">int</font> iPos, TokenPos<font color="black">&</font> token <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_FindAny<font color="black">(</font> MCD_PCSZ pDoc, <font color="blue">int</font><font color="black">&</font> nChar <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_FindName<font color="black">(</font> TokenPos<font color="black">&</font> token <font color="black">)</font>;
    <font color="blue">static</font> MCD_STR x_GetToken<font color="black">(</font> <font color="blue">const</font> TokenPos<font color="black">&</font> token <font color="black">)</font>;
    <font color="blue">int</font> x_FindElem<font color="black">(</font> <font color="blue">int</font> iPosParent, <font color="blue">int</font> iPos, MCD_PCSZ szPath <font color="black">)</font> <font color="blue">const</font>;
    MCD_STR x_GetPath<font color="black">(</font> <font color="blue">int</font> iPos <font color="black">)</font> <font color="blue">const</font>;
    MCD_STR x_GetTagName<font color="black">(</font> <font color="blue">int</font> iPos <font color="black">)</font> <font color="blue">const</font>;
    MCD_STR x_GetData<font color="black">(</font> <font color="blue">int</font> iPos <font color="black">)</font> <font color="blue">const</font>;
    MCD_STR x_GetAttrib<font color="black">(</font> <font color="blue">int</font> iPos, MCD_PCSZ pAttrib <font color="black">)</font> <font color="blue">const</font>;
    <font color="blue">static</font> MCD_STR x_EncodeCDATASection<font color="black">(</font> MCD_PCSZ szData <font color="black">)</font>;
    <font color="blue">bool</font> x_AddElem<font color="black">(</font> MCD_PCSZ pName, MCD_PCSZ pValue, <font color="blue">int</font> nFlags <font color="black">)</font>;
    <font color="blue">bool</font> x_AddElem<font color="black">(</font> MCD_PCSZ pName, <font color="blue">int</font> nValue, <font color="blue">int</font> nFlags <font color="black">)</font>;
    MCD_STR x_GetSubDoc<font color="black">(</font> <font color="blue">int</font> iPos <font color="black">)</font> <font color="blue">const</font>;
    <font color="blue">bool</font> x_AddSubDoc<font color="black">(</font> MCD_PCSZ pSubDoc, <font color="blue">int</font> nFlags <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_FindAttrib<font color="black">(</font> TokenPos<font color="black">&</font> token, MCD_PCSZ pAttrib, <font color="blue">int</font> n<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font>;
    <font color="blue">bool</font> x_SetAttrib<font color="black">(</font> <font color="blue">int</font> iPos, MCD_PCSZ pAttrib, MCD_PCSZ pValue, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font>;
    <font color="blue">bool</font> x_SetAttrib<font color="black">(</font> <font color="blue">int</font> iPos, MCD_PCSZ pAttrib, <font color="blue">int</font> nValue, <font color="blue">int</font> nFlags<font color="black">=</font><font color="maroon">0</font> <font color="black">)</font>;
    <font color="blue">bool</font> x_AddNode<font color="black">(</font> <font color="blue">int</font> nNodeType, MCD_PCSZ pText, <font color="blue">int</font> nNodeFlags <font color="black">)</font>;
    <font color="blue">void</font> x_RemoveNode<font color="black">(</font> <font color="blue">int</font> iPosParent, <font color="blue">int</font><font color="black">&</font> iPos, <font color="blue">int</font><font color="black">&</font> nNodeType, <font color="blue">int</font><font color="black">&</font> nNodeOffset, <font color="blue">int</font><font color="black">&</font> nNodeLength <font color="black">)</font>;
    <font color="blue">void</font> x_AdjustForNode<font color="black">(</font> <font color="blue">int</font> iPosParent, <font color="blue">int</font> iPos, <font color="blue">int</font> nShift <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_CreateNode<font color="black">(</font> MCD_STR<font color="black">&</font> strNode, <font color="blue">int</font> nNodeType, MCD_PCSZ pText <font color="black">)</font>;
    <font color="blue">int</font> x_InsertNew<font color="black">(</font> <font color="blue">int</font> iPosParent, <font color="blue">int</font><font color="black">&</font> iPosRel, NodePos<font color="black">&</font> node <font color="black">)</font>;
    <font color="blue">void</font> x_LinkElem<font color="black">(</font> <font color="blue">int</font> iPosParent, <font color="blue">int</font> iPosBefore, <font color="blue">int</font> iPos <font color="black">)</font>;
    <font color="blue">int</font> x_UnlinkElem<font color="black">(</font> <font color="blue">int</font> iPos <font color="black">)</font>;
    <font color="blue">int</font> x_ReleaseSubDoc<font color="black">(</font> <font color="blue">int</font> iPos <font color="black">)</font>;
    <font color="blue">int</font> x_ReleasePos<font color="black">(</font> <font color="blue">int</font> iPos <font color="black">)</font>;
    <font color="blue">bool</font> x_GetMap<font color="black">(</font> SavedPosMap<font color="black">*</font><font color="black">&</font> pMap, <font color="blue">int</font> nMap, <font color="blue">int</font> nMapSize <font color="black">=</font> <font color="maroon">7</font> <font color="black">)</font>;
    <font color="blue">void</font> x_CheckSavedPos<font color="black">(</font><font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">int</font> x_ParseNode<font color="black">(</font> TokenPos<font color="black">&</font> token, NodePos<font color="black">&</font> node <font color="black">)</font>;
    <font color="blue">bool</font> x_SetData<font color="black">(</font> <font color="blue">int</font> iPos, MCD_PCSZ szData, <font color="blue">int</font> nFlags <font color="black">)</font>;
    <font color="blue">bool</font> x_SetData<font color="black">(</font> <font color="blue">int</font> iPos, <font color="blue">int</font> nValue <font color="black">)</font>;
    <font color="blue">int</font> x_RemoveElem<font color="black">(</font> <font color="blue">int</font> iPos <font color="black">)</font>;
    MCD_STR x_GetElemContent<font color="black">(</font> <font color="blue">int</font> iPos <font color="black">)</font> <font color="blue">const</font>;
    <font color="blue">bool</font> x_SetElemContent<font color="black">(</font> MCD_PCSZ szContent <font color="black">)</font>;
    <font color="blue">void</font> x_DocChange<font color="black">(</font> <font color="blue">int</font> nLeft, <font color="blue">int</font> nReplace, <font color="blue">const</font> MCD_STR<font color="black">&</font> strInsert <font color="black">)</font>;
    <font color="blue">void</font> x_Adjust<font color="black">(</font> <font color="blue">int</font> iPos, <font color="blue">int</font> nShift, <font color="blue">bool</font> bAfterPos <font color="black">=</font> <font color="blue">false</font> <font color="black">)</font>;
    <font color="blue">static</font> MCD_STR x_GetLastError<font color="black">(</font><font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">int</font> x_Hash<font color="black">(</font> MCD_PCSZ p, <font color="blue">int</font> nSize <font color="black">)</font> <font color="black">{</font> <font color="blue">unsigned</font> <font color="blue">int</font> n<font color="black">=</font><font color="maroon">0</font>; <font color="blue">while</font> <font color="black">(</font><font color="black">*</font>p<font color="black">)</font> n <font color="black">+</font><font color="black">=</font> <font color="black">(</font><font color="blue">unsigned</font> <font color="blue">int</font><font color="black">)</font><font color="black">(</font><font color="black">*</font>p<font color="black">+</font><font color="black">+</font><font color="black">)</font>; <font color="blue">return</font> n % nSize; <font color="black">}</font>;
    <font color="blue">static</font> <font color="blue">int</font> x_GetEncodingCodePage<font color="black">(</font> MCD_CSTR psz7Encoding <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_EndianSwapRequired<font color="black">(</font> <font color="blue">int</font> nDocFlags <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">void</font> x_EndianSwapUTF16<font color="black">(</font> <font color="blue">unsigned</font> <font color="blue">short</font><font color="black">*</font> pUTF16, <font color="blue">int</font> nCharLen <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_CanConvert<font color="black">(</font> MCD_CSTR pszToEnc, MCD_CSTR pszFromEnc <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">int</font> x_ConvertEncoding<font color="black">(</font> ConvertEncoding<font color="black">&</font> convert, <font color="blue">void</font><font color="black">*</font> pTo <font color="black">)</font>;
<font color="blue">#if</font> defined<font color="black">(</font>MARKUP_ICONV<font color="black">)</font>
    <font color="blue">static</font> <font color="blue">int</font> x_IConv<font color="black">(</font> ConvertEncoding<font color="black">&</font> convert, <font color="blue">void</font><font color="black">*</font> pTo, <font color="blue">int</font> nToCharSize, <font color="blue">int</font> nFromCharSize <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">const</font> <font color="blue">char</font><font color="black">*</font> x_IConvName<font color="black">(</font> <font color="blue">char</font><font color="black">*</font> szEncoding, MCD_CSTR pszEncoding <font color="black">)</font>;
<font color="blue">#endif</font>
    <font color="blue">static</font> <font color="blue">bool</font> x_Open<font color="black">(</font> MCD_CSTR_FILENAME szFileName, FilePos<font color="black">&</font> file <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_Read<font color="black">(</font> <font color="blue">void</font><font color="black">*</font> pBuffer, FilePos<font color="black">&</font> file <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_ReadText<font color="black">(</font> MCD_STR<font color="black">&</font> strDoc, FilePos<font color="black">&</font> file <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_Write<font color="black">(</font> <font color="blue">void</font><font color="black">*</font> pBuffer, FilePos<font color="black">&</font> file, <font color="blue">const</font> <font color="blue">void</font><font color="black">*</font> pConstBuffer <font color="black">=</font> NULL <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_WriteText<font color="black">(</font> <font color="blue">const</font> MCD_STR<font color="black">&</font> strDoc, FilePos<font color="black">&</font> file <font color="black">)</font>;
    <font color="blue">static</font> <font color="blue">bool</font> x_Close<font color="black">(</font> FilePos<font color="black">&</font> file <font color="black">)</font>;
    <font color="blue">static</font> MCD_STR x_IntToStr<font color="black">(</font> <font color="blue">int</font> n <font color="black">)</font> <font color="black">{</font> MCD_CHAR sz<font color="black">[</font><font color="maroon">25</font><font color="black">]</font>; MCD_SPRINTF<font color="black">(</font>MCD_SSZ<font color="black">(</font>sz<font color="black">)</font>,MCD_T<font color="black">(</font><font color="maroon">"%d"</font><font color="black">)</font>,n<font color="black">)</font>; MCD_STR s<font color="black">=</font>sz; <font color="blue">return</font> s; <font color="black">}</font>;
<font color="black">}</font>;

<font color="blue">#endif</font> <font color="green">// !defined(_MARKUP_H_INCLUDED_)</font>

</PRE>
</BODY>
</HTML>
